#!/bin/env bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && cd .. && pwd )"
PWD="$(pwd)"

MTT_TEST_IMAGE_NAME="mtt-pytest"
MTT_TEST_IMAGE_TAG="latest"

MTT_TEST_IMAGE="${MTT_TEST_IMAGE_NAME}:${MTT_TEST_IMAGE_TAG}"

SHARED_ENVS="-e AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY -e AWS_SESSION_TOKEN"

docker build -t "${MTT_TEST_IMAGE}" "$DIR"
docker run --rm -ti ${SHARED_ENVS} -v "${PWD}:${PWD}" -w "${PWD}" "${MTT_TEST_IMAGE}" $@
